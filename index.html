<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diamond - Better Gaming</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <style>
    /* Other styles remain the same */

    /* Fullscreen Button in the Modal */
    #fullscreenBtn {
      position: absolute;
      top: 16px;
      left: 20px;
      z-index: 70;
      padding: 8px 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.06);
      border: none;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    #fullscreenBtn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Styling for Modal when it's fullscreen */
    #modal.fullscreen {
      position: fixed;
      inset: 0;
      z-index: 1000; /* Ensure it's on top */
      background: rgba(2, 6, 23, 0.8);
    }

    #modal.fullscreen > div {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
      overflow: hidden;
    }

    /* Ensure iframe takes up full screen when in fullscreen mode */
    #gameFrame.fullscreen {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="hud">
    <!-- Hud content here -->
  </div>

  <main>
    <section class="hero">
      <!-- Hero content here -->
    </section>

    <section class="grid" id="grid">
      <!-- cards injected by JS -->
    </section>
  </main>

  <!-- Modal with Fullscreen Button -->
  <div id="modal" style="display:none; justify-content: center; align-items: center;">
    <div style="width: 92%; max-width: 1100px; height: 80vh; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.04); box-shadow: 0 30px 80px rgba(0,0,0,0.6); background: #07070b;">
      <!-- Fullscreen Button -->
      <button id="fullscreenBtn">Fullscreen</button>
      <button id="closeModal" style="position:absolute;right:20px;top:16px;z-index:70;padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.06);border:none;color:#fff;cursor:pointer">Close</button>
      <iframe id="gameFrame" style="width:100%;height:100%;border:none" sandbox="allow-scripts allow-same-origin allow-pointer-lock"></iframe>
    </div>
  </div>

<script>
  let GAMES = [];
  let APPS = [];

  const grid = document.getElementById('grid');
  const q = document.getElementById('q');
  const modal = document.getElementById('modal');
  const gameFrame = document.getElementById('gameFrame');
  const closeModal = document.getElementById('closeModal');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const gamesTab = document.getElementById('gamesTab');
  const appsTab = document.getElementById('appsTab');
  const gamesCountElement = document.getElementById('gamesCount');

  function loadGames() {
    fetch('arcade_data.json')
      .then(r => r.json())
      .then(data => {
        GAMES = data.games;
        render(GAMES);
        updateCount(); 
      })
      .catch(err => console.error('JSON load error', err));
  }

  function loadApps() {
    fetch('apps_data.json')
      .then(r => r.json())
      .then(data => {
        APPS = data.apps;
        render(APPS);
        updateCount();
      })
      .catch(err => console.error('JSON load error', err));
  }

  function createCard(item) {
    const el = document.createElement('article');
    el.className = 'card';

    const img = document.createElement('img');
    img.className = 'thumb';
    img.src = item.thumb;
    img.alt = item.title;

    const meta = document.createElement('div'); meta.className = 'meta';
    const h3 = document.createElement('h3'); h3.textContent = item.title;
    const btn = document.createElement('button'); btn.className = 'play'; btn.textContent = 'Play';

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      openItem(item);
    });

    meta.appendChild(h3); meta.appendChild(btn);
    el.appendChild(img); el.appendChild(meta);

    return el;
  }

  function render(items) {
    grid.innerHTML = '';
    items.filter(item => item.title.toLowerCase().includes(q.value.toLowerCase())).forEach(item => grid.appendChild(createCard(item)));
  }

  function openItem(item) {
    fetch(item.src)
      .then(response => response.text())
      .then(htmlContent => {
        gameFrame.contentDocument.open();
        gameFrame.contentDocument.write(htmlContent);
        gameFrame.contentDocument.close();
        modal.style.display = 'flex';
      })
      .catch(error => {
        console.error('Error loading item content:', error);
        gameFrame.contentDocument.open();
        gameFrame.contentDocument.write(`
          <div style="padding: 20px; color: white; background: #b91c1c; text-align: center; font-family: sans-serif; border-radius: 8px;">
            <h2 style="margin-top: 0; color: white;">ðŸ›‘ Error Loading Item ðŸ›‘</h2>
            <p>Could not load content. This usually happens when the host server sends the wrong file type.</p>
          </div>
        `);
        gameFrame.contentDocument.close();
      });
  }

  closeModal.addEventListener('click', () => {
    modal.style.display = 'none';
    gameFrame.src = '';
  });

  fullscreenBtn.addEventListener('click', () => {
    // Toggle fullscreen mode
    if (!document.fullscreenElement) {
      // Enter fullscreen
      modal.classList.add('fullscreen');
      gameFrame.classList.add('fullscreen');
      modal.requestFullscreen();
    } else {
      // Exit fullscreen
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
      modal.classList.remove('fullscreen');
      gameFrame.classList.remove('fullscreen');
    }
  });

  q.addEventListener('input', () => {
    let filteredItems = gamesTab.classList.contains('active') ? GAMES : APPS;
    filteredItems = filteredItems.filter(item => item.title.toLowerCase().includes(q.value.toLowerCase()));
    render(filteredItems);
    updateCount(); 
  });

  gamesTab.addEventListener('click', () => {
    gamesTab.classList.add('active');
    appsTab.classList.remove('active');
    loadGames();
  });

  appsTab.addEventListener('click', () => {
    appsTab.classList.add('active');
    gamesTab.classList.remove('active');
    loadApps();
  });

  gamesTab.classList.add('active');
  loadGames();

  function updateCount() {
    const itemCount = gamesTab.classList.contains('active') ? GAMES.length : APPS.length;
    gamesCountElement.textContent = `Count: ${itemCount}`;
  }
</script>
</body>
</html>
